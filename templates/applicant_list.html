<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - University Job Fair</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="header">
        <div class="nav-container">
            <h1>Admin Dashboard</h1>
            <div class="nav-links">
                <button class="nav-toggle" onclick="toggleNavigation()">☰ Menu</button>
                <span>Welcome, {{ session.full_name }}!</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="navigation-tabs" id="navigationTabs">
            <div class="tab-container">
                <a href="{{ url_for('admin_dashboard') }}" class="nav-tab active">
                    <span class="tab-text">Applicants</span>
                </a>
                <a href="{{ url_for('admin_jobs') }}" class="nav-tab">
                    <span class="tab-text">Job Listings</span>
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            <span class="flash-text">{{ message }}</span>
                            <button class="flash-dismiss" onclick="dismissFlash(this)">&times;</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="dashboard-content">
            <div class="applicants-header">
                <h2>All Applicants</h2>
                
                <div class="applicants-controls">
                    <div class="stats">
                        <div class="stat-card">
                            <h3>Total Applicants</h3>
                            <p class="stat-number">{{ applicants|length }}</p>
                        </div>
                    </div>
                    
                    <div class="sort-controls">
                        <label for="sortBy">Sort by:</label>
                        <select id="sortBy" onchange="sortApplicants()">
                            <option value="name">Name</option>
                            <option value="date">Application Date</option>
                            <option value="major">Major</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="applicants-list" id="applicantsList">
                {% for applicant in applicants %}
                <div class="applicant-item" onclick="viewApplicantDetail({{ applicant.id }})">
                    <div class="applicant-info">
                        <h3 class="applicant-name">{{ applicant.full_name }}</h3>
                        <p class="applicant-major">{{ applicant.major }}</p>
                    </div>
                    <div class="applicant-actions">
                        <span class="view-detail">View Details →</span>
                    </div>
                </div>
                {% endfor %}
                
                {% if not applicants %}
                <div class="no-data">
                    <p>No applicants found.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>
    <script>
        // Store applicants data for sorting
        const applicantsData = {{ applicants|tojson }};

        function viewApplicantDetail(applicantId) {
            window.location.href = `/admin/applicant/${applicantId}`;
        }

        function sortApplicants() {
            const sortBy = document.getElementById('sortBy').value;
            const applicantsList = document.getElementById('applicantsList');
            
            // Sort the applicants data
            let sortedApplicants = [...applicantsData];
            
            switch(sortBy) {
                case 'name':
                    sortedApplicants.sort((a, b) => a.full_name.localeCompare(b.full_name));
                    break;
                case 'date':
                    sortedApplicants.sort((a, b) => new Date(a.application_date) - new Date(b.application_date));
                    break;
                case 'major':
                    sortedApplicants.sort((a, b) => a.major.localeCompare(b.major));
                    break;
            }
            
            // Re-render the applicants list
            renderApplicantsList(sortedApplicants);
        }

        function renderApplicantsList(applicants) {
            const applicantsList = document.getElementById('applicantsList');
            
            if (applicants.length === 0) {
                applicantsList.innerHTML = '<div class="no-data"><p>No applicants found.</p></div>';
                return;
            }
            
            applicantsList.innerHTML = applicants.map(applicant => `
                <div class="applicant-item" onclick="viewApplicantDetail(${applicant.id})">
                    <div class="applicant-info">
                        <h3 class="applicant-name">${applicant.full_name}</h3>
                        <p class="applicant-major">${applicant.major}</p>
                        <div class="applicant-details">
                            <span class="application-date">Applied: ${applicant.application_date}</span>
                        </div>
                    </div>
                    <div class="applicant-actions">
                        <span class="view-detail">View Details →</span>
                    </div>
                </div>
            `).join('');
        }

        function dismissFlash(button) {
            const flashMessage = button.parentElement;
            flashMessage.style.opacity = '0';
            flashMessage.style.transform = 'translateX(100%)';
            setTimeout(() => {
                flashMessage.remove();
                // Remove the entire flash-messages container if no messages left
                const flashContainer = document.querySelector('.flash-messages');
                if (flashContainer && flashContainer.children.length === 0) {
                    flashContainer.remove();
                }
            }, 300);
        }

        // Auto-dismiss flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(message => {
                setTimeout(() => {
                    const dismissBtn = message.querySelector('.flash-dismiss');
                    if (dismissBtn && message.parentElement) {
                        dismissFlash(dismissBtn);
                    }
                }, 5000);
            });
        });

        function toggleNavigation() {
            const navTabs = document.getElementById('navigationTabs');
            navTabs.classList.toggle('show');
        }

        // Close navigation when clicking outside
        document.addEventListener('click', function(event) {
            const navTabs = document.getElementById('navigationTabs');
            const navToggle = document.querySelector('.nav-toggle');
            
            if (!navTabs.contains(event.target) && !navToggle.contains(event.target)) {
                navTabs.classList.remove('show');
            }
        });
    </script>
</body>
</html>